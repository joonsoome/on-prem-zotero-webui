version: "3.8"

services:
  zotero-pdf-proxy:
    image: ${PDF_PROXY_IMAGE:-ghcr.io/joonsoome/on-prem-zotero-webui/pdf-proxy:main}
    environment:
      - ZOTERO_ROOT=/data/zotero
    volumes:
      - ${ZOTERO_ROOT_HOST_PATH:-/volume1/Reference/zotero}:/data/zotero
    ports:
      - "${PDF_PROXY_PORT:-8280}:8000"
    restart: unless-stopped

  web-library:
    image: ${WEB_LIBRARY_IMAGE:-ghcr.io/joonsoome/on-prem-zotero-webui/web-library:main}
    environment:
      - PDF_PROXY_BASE_URL=${PDF_PROXY_BASE_URL:-http://localhost:8280/pdf}
      - ZOTERO_API_KEY=${ZOTERO_API_KEY:-}
      - ZOTERO_API_AUTHORITY_PART=${ZOTERO_API_AUTHORITY_PART:-api.zotero.org}
      - ZOTERO_USER_SLUG=${ZOTERO_USER_SLUG:-zotero-user}
      - ZOTERO_USER_ID=${ZOTERO_USER_ID:-0}
      - ZOTERO_INCLUDE_MY_LIBRARY=${ZOTERO_INCLUDE_MY_LIBRARY:-true}
      - ZOTERO_INCLUDE_USER_GROUPS=${ZOTERO_INCLUDE_USER_GROUPS:-true}
      - ZOTERO_LIBRARIES_INCLUDE_JSON=${ZOTERO_LIBRARIES_INCLUDE_JSON:-[]}
      - WEB_LIBRARY_ALLOW_UPLOADS=${WEB_LIBRARY_ALLOW_UPLOADS:-false}
    ports:
      - "${WEB_LIBRARY_PORT:-8281}:80"
    depends_on:
      - zotero-pdf-proxy
    restart: unless-stopped
